<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de Consolas y Ventas</title>
  <style>
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 6px; }
    .consola { margin-bottom: 20px; padding: 10px; border: 1px solid #333; }
    .historial, .ventas, .registro, .corte { margin-top: 20px; }
    button { margin: 3px; }
  </style>
</head>
<body>
  <h1>Control de Consolas y Ventas</h1>

  <div id="consolas"></div>

  <div class="registro">
    <h3>Registrar venta</h3>
    Producto: <input type="text" id="producto"><br>
    Precio: <input type="number" id="precio"><br>
    Cantidad: <input type="number" id="cantidad" value="1"><br>
    <button onclick="registrarVenta()">Registrar</button>
  </div>

  <div class="ventas">
    <h3>Historial de Productos Vendidos</h3>
    <table id="tablaVentas">
      <tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Total</th><th>Eliminar</th></tr>
    </table>
    <h4>Total ventas: $<span id="totalVentas">0</span></h4>
  </div>

  <div class="historial">
    <h3>Historial de Consolas</h3>
    <table id="historialTabla">
      <tr><th>Consola</th><th>Tiempo</th><th>Pago</th><th>Fecha</th><th>Eliminar</th></tr>
    </table>
  </div>

  <div class="corte">
    <button onclick="realizarCorte()">Corte del día</button>
    <p id="resultadoCorte"></p>
  </div>

  <audio id="sonidoFin">
    <source src="https://www.soundjay.com/button/beep-07.wav" type="audio/wav">
  </audio>

  <script>
    let tiempos = {};
    let historial = [];
    let ventas = [];

    const historialTabla = document.getElementById("historialTabla");
    const tablaVentas = document.getElementById("tablaVentas");
    const totalVentas = document.getElementById("totalVentas");

    function crearConsolas() {
      const contenedor = document.getElementById("consolas");
      for (let i = 1; i <= 5; i++) {
        tiempos[i] = 0;
        const div = document.createElement("div");
        div.className = "consola";
        div.innerHTML = `
          <h3>Consola ${i}</h3>
          Tiempo (min): <input type="number" id="tiempo${i}" value="0"><br>
          <button onclick="iniciarTemporizador(${i})">Iniciar</button>
          <button onclick="agregarMinuto(${i})">+1 min</button>
          <p id="contador${i}">0 min restantes</p>
        `;
        contenedor.appendChild(div);
      }
    }

    function iniciarTemporizador(num) {
      const tiempoInput = document.getElementById(`tiempo${num}`);
      let tiempo = parseInt(tiempoInput.value);
      if (tiempo <= 0) return alert("Ingresa un tiempo válido");

      tiempos[num] = tiempo;
      actualizarContador(num);

      const intervalo = setInterval(() => {
        tiempos[num]--;
        actualizarContador(num);
        if (tiempos[num] <= 0) {
          clearInterval(intervalo);
          agregarAHistorial(num);
          reproducirSonido();
        }
      }, 60000);
    }

    function agregarMinuto(num) {
      tiempos[num]++;
      actualizarContador(num);
    }

    function actualizarContador(num) {
      document.getElementById(`contador${num}`).innerText = `${tiempos[num]} min restantes`;
    }

    function agregarAHistorial(num) {
      const tiempoUsado = document.getElementById(`tiempo${num}`).value;
      const pago = tiempoUsado * 1; // puedes cambiar la tarifa
      const fecha = new Date().toLocaleString();
      const id = Date.now() + Math.random();

      historial.push({ id, consola: num, tiempo: tiempoUsado, pago, fecha });
      actualizarHistorial();
    }

    function actualizarHistorial() {
      historialTabla.innerHTML = `<tr><th>Consola</th><th>Tiempo</th><th>Pago</th><th>Fecha</th><th>Eliminar</th></tr>`;
      historial.forEach(entry => {
        historialTabla.innerHTML += `
          <tr>
            <td>Consola ${entry.consola}</td>
            <td>${entry.tiempo} min</td>
            <td>$${entry.pago}</td>
            <td>${entry.fecha}</td>
            <td><button onclick="eliminarHistorial(${entry.id})">❌</button></td>
          </tr>`;
      });
    }

    function eliminarHistorial(id) {
      historial = historial.filter(e => e.id !== id);
      actualizarHistorial();
    }

    function registrarVenta() {
      const producto = document.getElementById("producto").value.trim();
      const precio = parseFloat(document.getElementById("precio").value);
      const cantidad = parseInt(document.getElementById("cantidad").value);
      if (!producto || precio <= 0 || cantidad <= 0) return alert("Datos inválidos");

      const total = precio * cantidad;
      const id = Date.now() + Math.random();
      ventas.push({ id, producto, precio, cantidad, total });
      actualizarVentas();
    }

    function actualizarVentas() {
      let suma = 0;
      tablaVentas.innerHTML = `<tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Total</th><th>Eliminar</th></tr>`;
      ventas.forEach(entry => {
        tablaVentas.innerHTML += `
          <tr>
            <td>${entry.producto}</td>
            <td>$${entry.precio}</td>
            <td>${entry.cantidad}</td>
            <td>$${entry.total}</td>
            <td><button onclick="eliminarVenta(${entry.id})">❌</button></td>
          </tr>`;
        suma += entry.total;
      });
      totalVentas.innerText = suma.toFixed(2);
    }

    function eliminarVenta(id) {
      ventas = ventas.filter(v => v.id !== id);
      actualizarVentas();
    }

    function realizarCorte() {
      const totalHistorial = historial.reduce((suma, h) => suma + Number(h.pago), 0);
      const totalProd = ventas.reduce((suma, v) => suma + v.total, 0);
      const totalFinal = totalHistorial + totalProd;

      document.getElementById("resultadoCorte").innerText = `
        Total consolas: $${totalHistorial.toFixed(2)} | Total ventas: $${totalProd.toFixed(2)} | Total del día: $${totalFinal.toFixed(2)}
      `;
    }

    function reproducirSonido() {
      document.getElementById("sonidoFin").play();
    }

    window.onload = () => {
      crearConsolas();
    };
  </script>
</body>
</html>
