  <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Control de Consolas</title>
  <style>
    body {
      font-family: sans-serif;
      background: #222;
      color: #eee;
      margin: 0;
      padding: 1rem;
    }
    h1 { text-align: center; }
    .consola {
      border: 2px solid #555;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      background-color: #333;
    }
    .consola input, .consola button {
      margin: 5px;
      padding: 6px;
      font-size: 1rem;
    }
    .historial {
      background: #111;
      margin-top: 2rem;
      padding: 1rem;
      border-radius: 8px;
    }
    .historial h3 { margin-top: 0; }
    .label { display: inline-block; width: 80px; }
  </style>
</head>
<body>
  <h1>üïπÔ∏è Administrador de Consolas</h1>

  <div id="contenedor"></div>

  <div class="historial">
    <h3>üìã Historial del d√≠a</h3>
    <ul id="historialLista"></ul>
  </div>

  <audio id="alarma" src="https://www.soundjay.com/buttons/beep-07.mp3" preload="auto"></audio>

  <script>
    const maxConsolas = 5;
    const contenedor = document.getElementById("contenedor");
    const historialLista = document.getElementById("historialLista");
    const alarma = document.getElementById("alarma");

    let datos = JSON.parse(localStorage.getItem("datosConsolas") || "[]");
    let historial = JSON.parse(localStorage.getItem("historial") || "[]");

    function guardarDatos() {
      localStorage.setItem("datosConsolas", JSON.stringify(datos));
      localStorage.setItem("historial", JSON.stringify(historial));
    }

    function actualizarHistorial() {
      historialLista.innerHTML = "";
      historial.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `${item.hora} - Consola ${item.numero} - ${item.minutos} min - $${item.pago}`;
        historialLista.appendChild(li);
      });
    }

    function crearConsola(index) {
      const div = document.createElement("div");
      div.className = "consola";

      const numero = document.createElement("input");
      numero.placeholder = "Consola #";
      numero.value = datos[index]?.numero || (index + 1);

      const tiempo = document.createElement("span");
      tiempo.textContent = "00:00";

      const minutosInput = document.createElement("input");
      minutosInput.type = "number";
      minutosInput.placeholder = "Min";

      const pagoInput = document.createElement("input");
      pagoInput.type = "number";
      pagoInput.placeholder = "$ pago";

      const iniciar = document.createElement("button");
      iniciar.textContent = "Iniciar";

      const pausar = document.createElement("button");
      pausar.textContent = "Pausar";

      const agregarMin = document.createElement("button");
      agregarMin.textContent = "+1 min";

      let tiempoRestante = 0;
      let interval = null;
      let pausado = false;

      function mostrarTiempo() {
        const m = Math.floor(tiempoRestante / 60).toString().padStart(2, '0');
        const s = (tiempoRestante % 60).toString().padStart(2, '0');
        tiempo.textContent = `${m}:${s}`;
      }

      function iniciarTemporizador() {
        const minutos = parseInt(minutosInput.value);
        if (isNaN(minutos) || minutos <= 0) return alert("Ingresa minutos v√°lidos");

        const pago = parseFloat(pagoInput.value) || 0;

        tiempoRestante = minutos * 60;
        mostrarTiempo();
        pausado = false;

        interval = setInterval(() => {
          if (!pausado && tiempoRestante > 0) {
            tiempoRestante--;
            mostrarTiempo();
            if (tiempoRestante === 0) {
              alarma.play();
              clearInterval(interval);
            }
          }
        }, 1000);

        historial.push({
          hora: new Date().toLocaleTimeString(),
          numero: numero.value,
          minutos,
          pago
        });
        datos[index] = { numero: numero.value, tiempoRestante, pausado: false };
        guardarDatos();
        actualizarHistorial();
      }

      function pausarTemporizador() {
        pausado = !pausado;
        pausar.textContent = pausado ? "Reanudar" : "Pausar";
        datos[index].pausado = pausado;
        guardarDatos();
      }

      function agregarUnMinuto() {
        tiempoRestante += 60;
        mostrarTiempo();
        datos[index].tiempoRestante = tiempoRestante;
        guardarDatos();
      }

      iniciar.onclick = iniciarTemporizador;
      pausar.onclick = pausarTemporizador;
      agregarMin.onclick = agregarUnMinuto;

      div.append(
        document.createTextNode("üéÆ "),
        numero,
        document.createElement("br"),
        minutosInput,
        pagoInput,
        iniciar,
        pausar,
        agregarMin,
        document.createElement("br"),
        tiempo
      );

      contenedor.appendChild(div);

      // Restaurar temporizador si exist√≠a
      if (datos[index]) {
        numero.value = datos[index].numero;
        tiempoRestante = datos[index].tiempoRestante;
        pausado = datos[index].pausado;
        mostrarTiempo();

        interval = setInterval(() => {
          if (!pausado && tiempoRestante > 0) {
            tiempoRestante--;
            mostrarTiempo();
            datos[index].tiempoRestante = tiempoRestante;
            guardarDatos();
            if (tiempoRestante === 0) {
              alarma.play();
              clearInterval(interval);
            }
          }
        }, 1000);
      }
    }

    for (let i = 0; i < maxConsolas; i++) {
      crearConsola(i);
    }

    actualizarHistorial();
  </script>
</body>
</html>
