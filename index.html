<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Administrador de Consolas</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; margin: 20px; }
    .consola, .producto-form { border: 1px solid #ccc; border-radius: 10px; background: white; padding: 15px; margin-bottom: 20px; }
    .consola h3, .producto-form h3 { margin-top: 0; }
    button { margin: 5px; padding: 5px 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
    th { background: #f0f0f0; }
  </style>
</head>
<body>

  <h1>Administrador de Consolas</h1>

  <div id="consolas"></div>

  <h2>Historial de Consolas</h2>
  <table id="historial">
    <thead>
      <tr>
        <th>Consola</th><th>Inicio</th><th>Duración</th><th>Pago</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="producto-form">
    <h3>Registrar Producto Vendido</h3>
    <input type="text" id="producto" placeholder="Producto" />
    <input type="number" id="precio" placeholder="Precio unitario" />
    <input type="number" id="cantidad" placeholder="Cantidad" />
    <button onclick="registrarProducto()">Registrar Producto</button>
  </div>

  <h2>Productos Vendidos</h2>
  <table id="productos">
    <thead>
      <tr>
        <th>Producto</th><th>Precio</th><th>Cantidad</th><th>Total</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <audio id="beep" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

  <script>
    const NUM_CONSOLAS = 5;
    const consolasContainer = document.getElementById('consolas');
    const historial = JSON.parse(localStorage.getItem('historial') || '[]');
    const productos = JSON.parse(localStorage.getItem('productos') || '[]');

    const beep = document.getElementById('beep');

    const historialTable = document.querySelector('#historial tbody');
    const productosTable = document.querySelector('#productos tbody');

    function renderHistorial() {
      historialTable.innerHTML = '';
      historial.forEach(e => {
        const row = historialTable.insertRow();
        row.innerHTML = `<td>${e.id}</td><td>${e.inicio}</td><td>${e.duracion}</td><td>$${e.pago}</td>`;
      });
    }

    function renderProductos() {
      productosTable.innerHTML = '';
      productos.forEach(p => {
        const row = productosTable.insertRow();
        row.innerHTML = `<td>${p.nombre}</td><td>$${p.precio}</td><td>${p.cantidad}</td><td>$${p.total}</td>`;
      });
    }

    function registrarProducto() {
      const nombre = document.getElementById('producto').value;
      const precio = parseFloat(document.getElementById('precio').value);
      const cantidad = parseInt(document.getElementById('cantidad').value);
      if (!nombre || isNaN(precio) || isNaN(cantidad)) return alert("Llena todos los campos");
      const total = precio * cantidad;
      productos.push({ nombre, precio, cantidad, total });
      localStorage.setItem('productos', JSON.stringify(productos));
      renderProductos();
      document.getElementById('producto').value = '';
      document.getElementById('precio').value = '';
      document.getElementById('cantidad').value = '';
    }

    for (let i = 1; i <= NUM_CONSOLAS; i++) {
      const div = document.createElement('div');
      div.className = 'consola';
      div.innerHTML = `
        <h3>Consola ${i}</h3>
        <input type="number" id="minutos-${i}" placeholder="Minutos" />
        <input type="number" id="pago-${i}" placeholder="Pago $" />
        <button onclick="iniciar(${i})">Iniciar</button>
        <button onclick="pausar(${i})">Pausar</button>
        <button onclick="reanudar(${i})">Reanudar</button>
        <button onclick="agregarMinuto(${i})">+1 minuto</button>
        <p id="tiempo-${i}">00:00</p>
      `;
      consolasContainer.appendChild(div);
    }

    const timers = {};
    const pausados = {};

    function iniciar(id) {
      const minutos = parseInt(document.getElementById(`minutos-${id}`).value);
      const pago = parseFloat(document.getElementById(`pago-${id}`).value);
      if (isNaN(minutos)) return alert("Ingresa los minutos");
      const totalSegundos = minutos * 60;
      const inicio = new Date();
      const fin = new Date(inicio.getTime() + totalSegundos * 1000);
      timers[id] = { tiempo: totalSegundos, fin, interval: null, pausado: false, pago, inicio: inicio.toLocaleTimeString() };

      if (timers[id].interval) clearInterval(timers[id].interval);
      timers[id].interval = setInterval(() => actualizar(id), 1000);
    }

    function actualizar(id) {
      if (!timers[id] || timers[id].pausado) return;
      timers[id].tiempo--;
      const m = String(Math.floor(timers[id].tiempo / 60)).padStart(2, '0');
      const s = String(timers[id].tiempo % 60).padStart(2, '0');
      document.getElementById(`tiempo-${id}`).innerText = `${m}:${s}`;
      if (timers[id].tiempo <= 0) {
        clearInterval(timers[id].interval);
        beep.play();
        historial.push({
          id: `Consola ${id}`,
          inicio: timers[id].inicio,
          duracion: document.getElementById(`minutos-${id}`).value + ' min',
          pago: timers[id].pago || 0
        });
        localStorage.setItem('historial', JSON.stringify(historial));
        renderHistorial();
        alert(`¡Tiempo finalizado para Consola ${id}!`);
      }
    }

    function pausar(id) {
      if (timers[id]) timers[id].pausado = true;
    }

    function reanudar(id) {
      if (timers[id]) timers[id].pausado = false;
    }

    function agregarMinuto(id) {
      if (timers[id]) timers[id].tiempo += 60;
    }

    renderHistorial();
    renderProductos();
  </script>
</body>
</html>
