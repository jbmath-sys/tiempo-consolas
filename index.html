<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de Consolas</title>
  <style>
    body { font-family: Arial; text-align: center; background: #f0f0f0; }
    .consola { background: #fff; padding: 10px; margin: 10px; border-radius: 10px; box-shadow: 0 0 5px #999; display: inline-block; width: 250px; vertical-align: top; }
    .historial { margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #999; padding: 5px; font-size: 14px; }
    input, button { margin: 5px; }
  </style>
</head>
<body>
  <h1>Administrador de Tiempo de Consolas</h1>
  <div id="consolas"></div>

  <div class="historial">
    <h2>Historial del D√≠a</h2>
    <table id="tablaHistorial">
      <thead>
        <tr>
          <th>Consola</th>
          <th>Inicio</th>
          <th>Duraci√≥n</th>
          <th>Pago</th>
        </tr>
      </thead>
      <tbody id="cuerpoHistorial"></tbody>
    </table>
  </div>

  <audio id="sonidoFin" src="https://www.soundjay.com/buttons/sounds/beep-07.mp3" preload="auto"></audio>

  <script>
    const sonido = document.getElementById("sonidoFin");
    const historial = JSON.parse(localStorage.getItem("historialConsolas") || "[]");
    const contenedor = document.getElementById("consolas");
    const cuerpoHistorial = document.getElementById("cuerpoHistorial");

    const agregarFilaHistorial = (num, inicio, duracion, pago) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${num}</td><td>${inicio}</td><td>${duracion}</td><td>$${pago}</td>`;
      cuerpoHistorial.appendChild(tr);
    };

    historial.forEach(({ num, inicio, duracion, pago }) => {
      agregarFilaHistorial(num, inicio, duracion, pago);
    });

    const crearConsola = (num) => {
      const div = document.createElement("div");
      div.className = "consola";
      div.innerHTML = `
        <h3>üéÆ Consola ${num}</h3>
        <input type="number" placeholder="Minutos" min="1" id="min${num}">
        <input type="number" placeholder="Pago $" id="pago${num}">
        <br>
        <button onclick="iniciar(${num})">Iniciar</button>
        <button onclick="pausar(${num})">‚è∏Ô∏è</button>
        <button onclick="agregarMinuto(${num})">‚ûï1 min</button>
        <p id="timer${num}">00:00</p>
      `;
      contenedor.appendChild(div);
    };

    for (let i = 1; i <= 5; i++) crearConsola(i);

    const temporizadores = {};
    const estados = {};

    function iniciar(num) {
      const minInput = document.getElementById(`min${num}`);
      const pagoInput = document.getElementById(`pago${num}`);
      let minutos = parseInt(minInput.value) || 0;
      if (minutos <= 0) return alert("Minutos inv√°lidos");

      const inicio = new Date();
      const duracion = minutos * 60;
      let restante = duracion;
      estados[num] = { pausado: false, restante, inicio: inicio.toLocaleTimeString(), pago: parseFloat(pagoInput.value || 0).toFixed(2) };

      const actualizar = () => {
        if (estados[num].pausado) return;
        restante--;
        estados[num].restante = restante;
        const m = Math.floor(restante / 60).toString().padStart(2, "0");
        const s = (restante % 60).toString().padStart(2, "0");
        document.getElementById(`timer${num}`).textContent = `${m}:${s}`;
        if (restante <= 0) {
          clearInterval(temporizadores[num]);
          sonido.play();
          agregarFilaHistorial(num, estados[num].inicio, `${minutos} min`, estados[num].pago);
          historial.push({ num, inicio: estados[num].inicio, duracion: `${minutos} min`, pago: estados[num].pago });
          localStorage.setItem("historialConsolas", JSON.stringify(historial));
        }
      };

      actualizar();
      clearInterval(temporizadores[num]);
      temporizadores[num] = setInterval(actualizar, 1000);
    }

    function pausar(num) {
      if (!estados[num]) return;
      estados[num].pausado = !estados[num].pausado;
    }

    function agregarMinuto(num) {
      if (!estados[num]) return;
      estados[num].restante += 60;
    }
  </script>
</body>
</html>
