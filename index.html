<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de Consolas</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    .consola { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: #fff; }
    .tabla { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .tabla th, .tabla td { border: 1px solid #aaa; padding: 5px; text-align: center; }
    .producto-form input { margin-right: 10px; }
    button { margin: 3px; }
  </style>
</head>
<body>
  <h1>Control de Consolas</h1>
  <div id="consolas"></div>

  <h2>Registrar Venta</h2>
  <div class="producto-form">
    <input type="text" id="producto" placeholder="Producto">
    <input type="number" id="precio" placeholder="Precio" step="0.01">
    <input type="number" id="cantidad" placeholder="Cantidad">
    <button onclick="registrarVenta()">Registrar</button>
  </div>

  <h2>Historial de Consolas</h2>
  <table class="tabla">
    <thead>
      <tr><th>Consola</th><th>Tiempo</th><th>Pago</th><th>Fecha</th><th>Acciones</th></tr>
    </thead>
    <tbody id="historialTabla"></tbody>
  </table>

  <h2>Ventas</h2>
  <table class="tabla">
    <thead>
      <tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Total</th></tr>
    </thead>
    <tbody id="tablaVentas"></tbody>
  </table>
  <h3>Total Vendido: $<span id="totalVendido">0</span></h3>

  <button onclick="realizarCorte()">Realizar Corte del Día</button>

  <audio id="finSonido" src="https://www.soundjay.com/button/beep-07.wav"></audio>

  <script>
    const tiempos = {};
    const historial = JSON.parse(localStorage.getItem("historial")) || [];
    const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
    let totalVentas = calcularTotalVentas();

    function crearConsolas() {
      const contenedor = document.getElementById("consolas");
      for (let i = 1; i <= 5; i++) {
        tiempos[i] = 0;
        contenedor.innerHTML += `
          <div class="consola">
            <h3>Consola ${i}</h3>
            <input type="number" id="tiempo${i}" placeholder="Minutos">
            <button onclick="iniciarTemporizador(${i})">Iniciar</button>
            <button onclick="agregarMinuto(${i})">+1 Min</button>
            <span id="restante${i}"></span>
          </div>
        `;
      }
    }

    function iniciarTemporizador(n) {
      let minutos = parseInt(document.getElementById(`tiempo${n}`).value);
      if (isNaN(minutos) || minutos <= 0) return alert("Ingrese minutos válidos");
      tiempos[n] = minutos;
      actualizarDisplay(n);
      const intervalo = setInterval(() => {
        if (tiempos[n] <= 0) {
          clearInterval(intervalo);
          document.getElementById("finSonido").play();
          agregarAHistorial(n);
        } else {
          tiempos[n]--;
          actualizarDisplay(n);
        }
      }, 60000);
    }

    function agregarMinuto(n) {
      tiempos[n]++;
      actualizarDisplay(n);
    }

    function actualizarDisplay(n) {
      document.getElementById(`restante${n}`).innerText = `Tiempo restante: ${tiempos[n]} min`;
    }

    function agregarAHistorial(n) {
      const tiempo = parseInt(document.getElementById(`tiempo${n}`).value);
      const pago = (tiempo * 2).toFixed(2);
      const fecha = new Date().toLocaleString();
      const entrada = { consola: n, tiempo, pago, fecha };
      historial.push(entrada);
      localStorage.setItem("historial", JSON.stringify(historial));
      mostrarHistorial();
    }

    function mostrarHistorial() {
      const tabla = document.getElementById("historialTabla");
      tabla.innerHTML = "";
      historial.forEach((entry, index) => {
        tabla.innerHTML += `<tr>
          <td>Consola ${entry.consola}</td>
          <td>${entry.tiempo} min</td>
          <td>$${entry.pago}</td>
          <td>${entry.fecha}</td>
          <td><button onclick="eliminarHistorial(${index})">Eliminar</button></td>
        </tr>`;
      });
    }

    function eliminarHistorial(index) {
      if (confirm("¿Eliminar este registro?")) {
        historial.splice(index, 1);
        localStorage.setItem("historial", JSON.stringify(historial));
        mostrarHistorial();
      }
    }

    function registrarVenta() {
      const producto = document.getElementById("producto").value.trim();
      const precio = parseFloat(document.getElementById("precio").value);
      const cantidad = parseInt(document.getElementById("cantidad").value);
      if (!producto || isNaN(precio) || isNaN(cantidad)) return alert("Completa todos los campos correctamente");

      const total = (precio * cantidad).toFixed(2);
      ventas.push({ producto, precio, cantidad, total });
      localStorage.setItem("ventas", JSON.stringify(ventas));
      mostrarVentas();
    }

    function mostrarVentas() {
      const tabla = document.getElementById("tablaVentas");
      tabla.innerHTML = "";
      ventas.forEach(entry => {
        tabla.innerHTML += `<tr>
          <td>${entry.producto}</td>
          <td>$${parseFloat(entry.precio).toFixed(2)}</td>
          <td>${entry.cantidad}</td>
          <td>$${entry.total}</td>
        </tr>`;
      });
      totalVentas = calcularTotalVentas();
      document.getElementById("totalVendido").textContent = totalVentas.toFixed(2);
    }

    function calcularTotalVentas() {
      return ventas.reduce((sum, entry) => sum + parseFloat(entry.total), 0);
    }

    function realizarCorte() {
      let totalTiempo = historial.reduce((s, e) => s + parseFloat(e.pago), 0);
      let totalVenta = calcularTotalVentas();
      alert(`Total por consolas: $${totalTiempo.toFixed(2)}\nTotal por productos: $${totalVenta.toFixed(2)}\nTOTAL DEL DÍA: $${(totalTiempo + totalVenta).toFixed(2)}`);
    }

    window.onload = () => {
      crearConsolas();
      mostrarHistorial();
      mostrarVentas();
    };
  </script>
</body>
</html>
