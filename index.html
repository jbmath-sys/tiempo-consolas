<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Control de Consolas</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f3f3f3; margin: 20px; }
    .consola { border: 2px solid #555; padding: 10px; margin-bottom: 20px; border-radius: 8px; background: #fff; }
    .consola h3 { margin: 0 0 10px 0; }
    .boton { padding: 5px 10px; margin: 3px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: center; }
    .producto-input { margin: 10px 0; }
  </style>
</head>
<body>

  <h1>Administrador de Consolas</h1>

  <div id="consolas-container"></div>

  <h2>Registro de Productos Vendidos</h2>
  <div class="producto-input">
    <input type="text" id="producto" placeholder="Nombre del producto">
    <input type="number" id="precio" placeholder="Precio" step="0.01">
    <button onclick="agregarProducto()">Agregar producto</button>
  </div>

  <h2>Historial Diario</h2>
  <table id="historial">
    <thead>
      <tr>
        <th>Consola</th>
        <th>Inicio</th>
        <th>DuraciÃ³n</th>
        <th>Pago</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Productos Vendidos</h2>
  <table id="productos">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Precio</th>
        <th>Hora</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <audio id="alarma" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

  <script>
    const historialTabla = document.querySelector("#historial tbody");
    const productosTabla = document.querySelector("#productos tbody");
    const alarma = document.getElementById("alarma");

    const historial = JSON.parse(localStorage.getItem("historial")) || [];
    const productos = JSON.parse(localStorage.getItem("productos")) || [];

    function guardarDatos() {
      localStorage.setItem("historial", JSON.stringify(historial));
      localStorage.setItem("productos", JSON.stringify(productos));
    }

    function agregarFilaHistorial(consola, inicio, duracion, pago) {
      const fila = historialTabla.insertRow();
      fila.innerHTML = `<td>${consola}</td><td>${inicio}</td><td>${duracion}</td><td>$${pago}</td>`;
    }

    function agregarProducto() {
      const nombre = document.getElementById("producto").value;
      const precio = parseFloat(document.getElementById("precio").value);
      if (!nombre || isNaN(precio)) return alert("Ingresa producto y precio");

      const hora = new Date().toLocaleTimeString();
      productos.push({ nombre, precio, hora });
      guardarDatos();

      const fila = productosTabla.insertRow();
      fila.innerHTML = `<td>${nombre}</td><td>$${precio.toFixed(2)}</td><td>${hora}</td>`;

      document.getElementById("producto").value = "";
      document.getElementById("precio").value = "";
    }

    function crearConsola(i) {
      const div = document.createElement("div");
      div.className = "consola";
      div.innerHTML = `
        <h3>ðŸŽ® Consola <span id="numero-${i}">${i + 1}</span> - <input id="nombre-${i}" placeholder="Nombre o ID" /></h3>
        <label>Minutos: <input type="number" id="minutos-${i}" /></label>
        <label>Pago: $<input type="number" id="pago-${i}" step="0.01" /></label>
        <button class="boton" onclick="iniciar(${i})">Iniciar</button>
        <button class="boton" onclick="pausar(${i})">Pausar/Reanudar</button>
        <button class="boton" onclick="agregarMinuto(${i})">+1 Minuto</button>
        <p id="reloj-${i}">00:00</p>
      `;
      document.getElementById("consolas-container").appendChild(div);
    }

    let timers = Array(5).fill(null);
    let pausado = Array(5).fill(false);
    let segundosRestantes = Array(5).fill(0);

    function iniciar(i) {
      const minutos = parseInt(document.getElementById(`minutos-${i}`).value);
      const pago = parseFloat(document.getElementById(`pago-${i}`).value) || 0;
      const nombre = document.getElementById(`nombre-${i}`).value || `Consola ${i + 1}`;
      if (isNaN(minutos) || minutos <= 0) return alert("Minutos invÃ¡lidos");

      segundosRestantes[i] = minutos * 60;
      const inicio = new Date().toLocaleTimeString();

      clearInterval(timers[i]);
      pausado[i] = false;
      timers[i] = setInterval(() => {
        if (!pausado[i]) {
          segundosRestantes[i]--;
          const m = Math.floor(segundosRestantes[i] / 60);
          const s = segundosRestantes[i] % 60;
          document.getElementById(`reloj-${i}`).textContent = `${m.toString().padStart(2, "0")}:${s.toString().padStart(2, "0")}`;
          if (segundosRestantes[i] <= 0) {
            clearInterval(timers[i]);
            alarma.play();
            historial.push({ consola: nombre, inicio, duracion: `${minutos} min`, pago });
            agregarFilaHistorial(nombre, inicio, `${minutos} min`, pago.toFixed(2));
            guardarDatos();
          }
        }
      }, 1000);
    }

    function pausar(i) {
      pausado[i] = !pausado[i];
    }

    function agregarMinuto(i) {
      segundosRestantes[i] += 60;
    }

    // Renderizar historial guardado al cargar
    historial.forEach(h => agregarFilaHistorial(h.consola, h.inicio, h.duracion, h.pago));
    productos.forEach(p => {
      const fila = productosTabla.insertRow();
      fila.innerHTML = `<td>${p.nombre}</td><td>$${p.precio.toFixed(2)}</td><td>${p.hora}</td>`;
    });

    for (let i = 0; i < 5; i++) crearConsola(i);
  </script>
</body>
</html>
