<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Control de Consolas y Ventas - El Profe</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f3f3f3;
      padding: 20px;
    }
    h2 {
      margin-top: 40px;
    }
    .consola, .venta {
      margin: 10px 0;
      padding: 10px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    button {
      margin-left: 5px;
      padding: 5px 10px;
    }
    table {
      width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
    }
    td, th {
      padding: 6px;
      border: 1px solid #ccc;
    }
    input[type="number"], input[type="text"] {
      width: 120px;
    }
  </style>
</head>
<body>

<h1>Control de Consolas y Ventas</h1>

<div id="consolas"></div>

<h2>Registrar Venta</h2>
<div class="venta">
  <input type="text" id="producto" placeholder="Producto" />
  <input type="number" id="precio" placeholder="Precio" />
  <input type="number" id="cantidad" placeholder="Cantidad" />
  <button onclick="registrarVenta()">Registrar</button>
</div>

<h2>Historial de Tiempos</h2>
<table>
  <thead>
    <tr><th>Consola</th><th>Tiempo</th><th>Pago</th><th>Fecha</th><th>Eliminar</th></tr>
  </thead>
  <tbody id="historial"></tbody>
</table>

<h2>Historial de Ventas</h2>
<table>
  <thead>
    <tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Total</th><th>Eliminar</th></tr>
  </thead>
  <tbody id="ventas"></tbody>
</table>

<audio id="alerta" src="https://www.soundjay.com/button/beep-07.wav"></audio>

<script>
  const preciosPorMinuto = 1; // Precio por minuto
  const consolas = 5;
  const tiempos = Array(consolas + 1).fill(0);
  const intervalos = Array(consolas + 1).fill(null);
  let historial = JSON.parse(localStorage.getItem("historial")) || [];
  let ventas = JSON.parse(localStorage.getItem("ventas")) || [];

  const historialTabla = document.getElementById("historial");
  const tablaVentas = document.getElementById("ventas");
  const audio = document.getElementById("alerta");

  function crearConsolas() {
    const contenedor = document.getElementById("consolas");
    for (let i = 1; i <= consolas; i++) {
      const div = document.createElement("div");
      div.className = "consola";
      div.innerHTML = `
        <strong>Consola ${i}</strong>
        <input type="number" placeholder="Minutos" id="min${i}" />
        <button onclick="iniciar(${i})">Iniciar</button>
        <button onclick="pausar(${i})">Pausar</button>
        <button onclick="terminar(${i})">Terminar</button>
        <button onclick="cancelar(${i})">Cancelar</button>
        <span id="tiempo${i}">0 min</span>
      `;
      contenedor.appendChild(div);
    }
  }

  function actualizarTiempo(i) {
    const tiempoSpan = document.getElementById(`tiempo${i}`);
    tiempoSpan.textContent = `${tiempos[i]} min`;
  }

  function iniciar(i) {
    const input = document.getElementById(`min${i}`);
    const minutos = parseInt(input.value);
    if (!minutos || minutos <= 0) return alert("Ingresa minutos válidos");
    tiempos[i] = minutos;
    actualizarTiempo(i);

    if (intervalos[i]) clearInterval(intervalos[i]);
    intervalos[i] = setInterval(() => {
      tiempos[i]--;
      actualizarTiempo(i);
      if (tiempos[i] === 0) {
        clearInterval(intervalos[i]);
        audio.play();
        agregarAHistorial(i);
      }
    }, 60000);
  }

  function pausar(i) {
    clearInterval(intervalos[i]);
  }

  function terminar(i) {
    clearInterval(intervalos[i]);
    agregarAHistorial(i);
    tiempos[i] = 0;
    actualizarTiempo(i);
  }

  function cancelar(i) {
    clearInterval(intervalos[i]);
    tiempos[i] = 0;
    actualizarTiempo(i);
  }

  function agregarAHistorial(i) {
    const tiempoUsado = document.getElementById(`min${i}`).value;
    const pago = tiempoUsado * preciosPorMinuto;
    const fecha = new Date().toLocaleString();
    const entrada = {
      consola: i,
      tiempo: tiempoUsado,
      pago: pago.toFixed(2),
      fecha
    };
    historial.push(entrada);
    guardarHistorial();
    renderHistorial();
  }

  function registrarVenta() {
    const producto = document.getElementById("producto").value;
    const precio = parseFloat(document.getElementById("precio").value);
    const cantidad = parseInt(document.getElementById("cantidad").value);
    if (!producto || !precio || !cantidad || cantidad <= 0) return alert("Datos inválidos");
    const total = precio * cantidad;
    ventas.push({ producto, precio, cantidad, total });
    guardarVentas();
    renderVentas();
    document.getElementById("producto").value = "";
    document.getElementById("precio").value = "";
    document.getElementById("cantidad").value = "";
  }

  function renderHistorial() {
    historialTabla.innerHTML = "";
    historial.forEach((entry, index) => {
      historialTabla.innerHTML += `
        <tr>
          <td>Consola ${entry.consola}</td>
          <td>${entry.tiempo} min</td>
          <td>$${entry.pago}</td>
          <td>${entry.fecha}</td>
          <td><button onclick="eliminarHistorial(${index})">❌</button></td>
        </tr>`;
    });
  }

  function renderVentas() {
    tablaVentas.innerHTML = "";
    ventas.forEach((entry, index) => {
      tablaVentas.innerHTML += `
        <tr>
          <td>${entry.producto}</td>
          <td>$${entry.precio}</td>
          <td>${entry.cantidad}</td>
          <td>$${entry.total}</td>
          <td><button onclick="eliminarVenta(${index})">❌</button></td>
        </tr>`;
    });
  }

  function eliminarHistorial(index) {
    historial.splice(index, 1);
    guardarHistorial();
    renderHistorial();
  }

  function eliminarVenta(index) {
    ventas.splice(index, 1);
    guardarVentas();
    renderVentas();
  }

  function guardarHistorial() {
    localStorage.setItem("historial", JSON.stringify(historial));
  }

  function guardarVentas() {
    localStorage.setItem("ventas", JSON.stringify(ventas));
  }

  window.onload = () => {
    crearConsolas();
    renderHistorial();
    renderVentas();
  };
</script>

</body>
</html>

