<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de Consolas y Ventas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .consola {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 8px;
      text-align: left;
    }
    .boton {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>Control de Consolas</h2>
  <div id="consolas"></div>

  <h2>Registro de Ventas</h2>
  <input type="text" id="producto" placeholder="Producto">
  <input type="number" id="precio" placeholder="Precio">
  <input type="number" id="cantidad" placeholder="Cantidad">
  <button onclick="registrarVenta()">Registrar Venta</button>

  <h2>Historial de Consolas</h2>
  <table>
    <thead>
      <tr>
        <th>Consola</th><th>Tiempo</th><th>Pago</th><th>Fecha</th><th>Acción</th>
      </tr>
    </thead>
    <tbody id="historialTabla"></tbody>
  </table>

  <h2>Historial de Ventas</h2>
  <table>
    <thead>
      <tr>
        <th>Producto</th><th>Precio</th><th>Cantidad</th><th>Total</th>
      </tr>
    </thead>
    <tbody id="tablaVentas"></tbody>
  </table>

  <h2>Corte del Día</h2>
  <button onclick="realizarCorte()">Realizar Corte</button>
  <div id="corteResultados"></div>

  <audio id="sonido">
    <source src="https://www.soundjay.com/button/beep-07.wav" type="audio/wav">
  </audio>

  <script>
    const consolas = document.getElementById("consolas");
    const historialTabla = document.getElementById("historialTabla");
    const tablaVentas = document.getElementById("tablaVentas");
    const corteResultados = document.getElementById("corteResultados");
    const sonido = document.getElementById("sonido");

    let tiempos = JSON.parse(localStorage.getItem("tiempos")) || {};
    let historial = JSON.parse(localStorage.getItem("historial")) || [];
    let ventas = JSON.parse(localStorage.getItem("ventas")) || [];

    function guardarDatos() {
      localStorage.setItem("tiempos", JSON.stringify(tiempos));
      localStorage.setItem("historial", JSON.stringify(historial));
      localStorage.setItem("ventas", JSON.stringify(ventas));
    }

    function crearConsolas() {
      for (let i = 1; i <= 5; i++) {
        const div = document.createElement("div");
        div.className = "consola";
        div.innerHTML = `
          <strong>Consola ${i}</strong><br>
          Tiempo (min): <input type="number" id="tiempo${i}" placeholder="minutos">
          Pago: <input type="number" id="pago${i}" placeholder="$">
          <button onclick="iniciarTemporizador(${i})">Iniciar</button>
          <button onclick="eliminarTemporizador(${i})">Eliminar Tiempo</button>
          <span id="reloj${i}"></span>
        `;
        consolas.appendChild(div);
      }
    }

    function iniciarTemporizador(num) {
      const tiempo = parseInt(document.getElementById(`tiempo${num}`).value);
      const pago = parseFloat(document.getElementById(`pago${num}`).value);
      if (isNaN(tiempo) || isNaN(pago)) {
        alert("Ingresa tiempo y pago válidos.");
        return;
      }
      tiempos[num] = tiempo;
      guardarDatos();

      const fin = Date.now() + tiempo * 60000;
      const reloj = document.getElementById(`reloj${num}`);
      const intervalo = setInterval(() => {
        const restante = fin - Date.now();
        if (restante <= 0) {
          clearInterval(intervalo);
          reloj.textContent = "¡Terminado!";
          sonido.play();
          agregarAHistorial(num, tiempo, pago);
        } else {
          const min = Math.ceil(restante / 60000);
          reloj.textContent = `Tiempo restante: ${min} min`;
        }
      }, 1000);
    }

    function eliminarTemporizador(num) {
      delete tiempos[num];
      guardarDatos();
      document.getElementById(`reloj${num}`).textContent = "";
      document.getElementById(`tiempo${num}`).value = "";
      document.getElementById(`pago${num}`).value = "";
    }

    function agregarAHistorial(num, tiempo, pago) {
      const fecha = new Date().toLocaleString();
      historial.push({ consola: num, tiempo, pago, fecha });
      guardarDatos();
      cargarHistorial();
    }

    function cargarHistorial() {
      historialTabla.innerHTML = "";
      historial.forEach((entry, index) => {
        historialTabla.innerHTML += `
          <tr>
            <td>Consola ${entry.consola}</td>
            <td>${entry.tiempo} min</td>
            <td>$${entry.pago}</td>
            <td>${entry.fecha}</td>
            <td><button onclick="eliminarHistorial(${index})">Eliminar</button></td>
          </tr>`;
      });

      tablaVentas.innerHTML = "";
      ventas.forEach((entry) => {
        tablaVentas.innerHTML += `
          <tr>
            <td>${entry.producto}</td>
            <td>$${entry.precio}</td>
            <td>${entry.cantidad}</td>
            <td>$${entry.total}</td>
          </tr>`;
      });
    }

    function eliminarHistorial(index) {
      historial.splice(index, 1);
      guardarDatos();
      cargarHistorial();
    }

    function registrarVenta() {
      const producto = document.getElementById("producto").value;
      const precio = parseFloat(document.getElementById("precio").value);
      const cantidad = parseInt(document.getElementById("cantidad").value);
      if (!producto || isNaN(precio) || isNaN(cantidad)) {
        alert("Ingresa producto, precio y cantidad válidos.");
        return;
      }
      const total = precio * cantidad;
      ventas.push({ producto, precio, cantidad, total });
      guardarDatos();
      cargarHistorial();
    }

    function realizarCorte() {
      const totalConsolas = historial.reduce((acc, e) => acc + Number(e.pago), 0);
      const totalVentas = ventas.reduce((acc, v) => acc + v.total, 0);
      const total = totalConsolas + totalVentas;

      corteResultados.innerHTML = `
        <h3>Resumen del Corte del Día</h3>
        <p>Total por consolas: $${totalConsolas.toFixed(2)}</p>
        <p>Total por ventas: $${totalVentas.toFixed(2)}</p>
        <p><strong>Total general: $${total.toFixed(2)}</strong></p>
      `;

      // Si quieres borrar historial después del corte, descomenta:
      // historial = [];
      // ventas = [];
      // guardarDatos();
      // cargarHistorial();
    }

    window.onload = () => {
      crearConsolas();
      cargarHistorial();

      // Guardar historial si se cierra la página con consolas activas
      window.addEventListener("beforeunload", () => {
        for (let i = 1; i <= 5; i++) {
          if (tiempos[i]) {
            const pago = parseFloat(document.getElementById(`pago${i}`).value) || 0;
            agregarAHistorial(i, tiempos[i], pago);
          }
        }
      });
    };
  </script>
</body>
</html>

